# AC79 SDK é¡¹ç›®å¯åŠ¨æµç¨‹è¯¦è§£

## ğŸ“š ç›®å½•
1. [å¯åŠ¨æµç¨‹æ€»è§ˆ](#å¯åŠ¨æµç¨‹æ€»è§ˆ)
2. [å¯åŠ¨é˜¶æ®µè¯¦è§£](#å¯åŠ¨é˜¶æ®µè¯¦è§£)
3. [å…³é”®æ•°æ®ç»“æ„](#å…³é”®æ•°æ®ç»“æ„)
4. [åˆå§‹åŒ–æœºåˆ¶](#åˆå§‹åŒ–æœºåˆ¶)
5. [åº”ç”¨ç¨‹åºå¯åŠ¨](#åº”ç”¨ç¨‹åºå¯åŠ¨)
6. [ä»»åŠ¡åˆ—è¡¨](#ä»»åŠ¡åˆ—è¡¨)
7. [å¯åŠ¨æµç¨‹å›¾](#å¯åŠ¨æµç¨‹å›¾)

---

## 1ï¸âƒ£ å¯åŠ¨æµç¨‹æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç¡¬ä»¶å¤ä½ / ä¸Šç”µå¯åŠ¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜¶æ®µ1: å¼•å¯¼åŠ è½½ (Bootloader)                   â”‚
â”‚   - ä»FlashåŠ è½½ä»£ç åˆ°å†…å­˜                        â”‚
â”‚   - _start å…¥å£ç‚¹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜¶æ®µ2: main() å‡½æ•° (apps/common/system/init.c)â”‚
â”‚   â”œâ”€ setup_arch()       // CPUæ¶æ„åˆå§‹åŒ–         â”‚
â”‚   â”œâ”€ os_init()          // æ“ä½œç³»ç»Ÿåˆå§‹åŒ–        â”‚
â”‚   â”œâ”€ task_create()      // åˆ›å»ºapp_coreä»»åŠ¡     â”‚
â”‚   â””â”€ os_start()         // å¯åŠ¨RTOSè°ƒåº¦å™¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜¶æ®µ3: app_task_handler() ä»»åŠ¡                 â”‚
â”‚   â”œâ”€ sys_timer_init()         // ç³»ç»Ÿå®šæ—¶å™¨      â”‚
â”‚   â”œâ”€ board_early_init()       // æ¿çº§æ—©æœŸåˆå§‹åŒ–  â”‚
â”‚   â”œâ”€ __do_initcall(early)     // æ—©æœŸåˆå§‹åŒ–å›è°ƒ  â”‚
â”‚   â”œâ”€ __do_initcall(platform)  // å¹³å°åˆå§‹åŒ–      â”‚
â”‚   â”œâ”€ board_init()             // æ¿çº§åˆå§‹åŒ–      â”‚
â”‚   â”œâ”€ __do_initcall(initcall)  // æ¨¡å—åˆå§‹åŒ–      â”‚
â”‚   â”œâ”€ __do_initcall(module)    // æ¨¡å—åˆå§‹åŒ–å›è°ƒ  â”‚
â”‚   â”œâ”€ app_core_init()          // åº”ç”¨æ ¸å¿ƒåˆå§‹åŒ–  â”‚
â”‚   â”œâ”€ __do_initcall(late)      // åæœŸåˆå§‹åŒ–å›è°ƒ  â”‚
â”‚   â””â”€ app_main()               // åº”ç”¨ä¸»å‡½æ•°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜¶æ®µ4: app_main() åº”ç”¨å¯åŠ¨                     â”‚
â”‚   â”œâ”€ init_intent()            // åˆå§‹åŒ–æ„å›¾      â”‚
â”‚   â”œâ”€ start_app()              // å¯åŠ¨åº”ç”¨        â”‚
â”‚   â””â”€ è¿›å…¥åº”ç”¨ä¸»å¾ªç¯                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜¶æ®µ5: ä¸»å¾ªç¯ (äº‹ä»¶é©±åŠ¨)                      â”‚
â”‚   - å¤„ç†ç³»ç»Ÿäº‹ä»¶                                 â”‚
â”‚   - å¤„ç†æŒ‰é”®äº‹ä»¶                                 â”‚
â”‚   - å¤„ç†ç½‘ç»œäº‹ä»¶                                 â”‚
â”‚   - å¤„ç†è“ç‰™äº‹ä»¶                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ å¯åŠ¨é˜¶æ®µè¯¦è§£

### ğŸ”§ é˜¶æ®µ1: Bootloaderå’Œé“¾æ¥è„šæœ¬

**ä½ç½®**: `cpu/wl82/sdk_ld_sfc.c` / `cpu/wl82/sdk_ld_sdram.c`

**å†…å­˜å¸ƒå±€**:
```c
MEMORY
{
    rom(rx)       : ORIGIN = 0x2000120, LENGTH = __FLASH_SIZE__  // Flash ROM
    sdram(rwx)    : ORIGIN = 0x4000120, LENGTH = SDRAM_SIZE      // SDRAM
    ram0(rwx)     : ORIGIN = 0x1c00000, LENGTH = RAM0_SIZE       // å†…éƒ¨RAM
    boot_info(rwx): ORIGIN = ..., LENGTH = BOOT_INFO_SIZE        // å¯åŠ¨ä¿¡æ¯
    cache_ram(rw) : ORIGIN = 0x1f20000, LENGTH = CACHE_RAM_SIZE  // Cache RAM
}
```

**å…³é”®é…ç½®**:
- `BOOT_INFO_SIZE = 52` å­—èŠ‚
- `RAM0_SIZE` = çº¦8MBå†…éƒ¨RAM
- `SDRAM_SIZE` = 2MBå¤–éƒ¨SDRAMï¼ˆå¯é€‰ï¼‰
- `TLB_SIZE` = MMUé¡µè¡¨å¤§å°ï¼ˆå¦‚å¯ç”¨MMUï¼‰

**é“¾æ¥æ®µ**:
```
.text     â†’ ä»£ç æ®µ (Flashæˆ–SDRAM)
.data     â†’ åˆå§‹åŒ–æ•°æ®æ®µ (SDRAM)
.bss      â†’ æœªåˆå§‹åŒ–æ•°æ®æ®µ (SDRAM)
.stack    â†’ å †æ ˆæ®µ (RAM0)
```

---

### ğŸš€ é˜¶æ®µ2: main() å‡½æ•°

**ä½ç½®**: `apps/common/system/init.c:264`

```c
int main()
{
    // 1. ç¦ç”¨ä¸­æ–­
    __local_irq_disable();

    // 2. CPUæ¶æ„åˆå§‹åŒ–
    setup_arch();

    // 3. å¯ç”¨ç¬¬äºŒä¸ªCPUæ ¸å¿ƒï¼ˆåŒæ ¸æ¨¡å¼ï¼‰
    #if CPU_CORE_NUM == 1
        EnableOtherCpu();
    #endif

    // 4. æ“ä½œç³»ç»Ÿåˆå§‹åŒ–
    os_init();

    // 5. åˆ›å»ºappæ ¸å¿ƒä»»åŠ¡
    task_create(app_task_handler, NULL, "app_core");

    // 6. å¯åŠ¨RTOSè°ƒåº¦å™¨
    os_start();

    // 7. ä½¿èƒ½ä¸­æ–­
    __local_irq_enable();

    return 0;
}
```

#### ğŸ“Œ 2.1 setup_arch() - CPUæ¶æ„åˆå§‹åŒ–

**ä½ç½®**: `cpu/wl82/setup.c:6`

```c
void setup_arch()
{
    // 1. çœ‹é—¨ç‹—åˆå§‹åŒ–
    wdt_init(0x0f);

    // 2. æ—¶é’Ÿæ—©æœŸåˆå§‹åŒ–
    clk_early_init();

    // 3. ä¸­æ–­æ§åˆ¶å™¨åˆå§‹åŒ–
    interrupt_init();

    // 4. è°ƒè¯•ä¸²å£åˆå§‹åŒ– (å¦‚å¯ç”¨DEBUG)
    #ifdef CONFIG_DEBUG_ENABLE
        debug_uart_init();
        log_early_init(10 * 1024);  // 10KBæ—¥å¿—ç¼“å†²
    #endif

    // 5. è·å–ç³»ç»Ÿå¤ä½åŸå› 
    system_reset_reason_get();

    // 6. æ‰“å°èŠ¯ç‰‡ä¿¡æ¯
    printf("WL82(AC791N) CHIP_ID: 0x%x", JL_INTEST->CHIP_ID);
    
    // 7. æ‰“å°å†…å­˜å¸ƒå±€
    printf("sys_clk = %d, sdram_clk = %d", clk_get("sys"), clk_get("sdram"));
    printf("SDRAM_SIZE = %d, DATA_SIZE = %d, BSS_SIZE = %d", ...);
    printf("RAM_SIZE = %d, HEAP_SIZE = %d", ...);

    // 8. å¯ç§»åŠ¨ä»£ç åˆå§‹åŒ–
    code_movable_init();

    // 9. Debugç³»ç»Ÿåˆå§‹åŒ–
    debug_init();

    // 10. CRC16äº’æ–¥é”åˆå§‹åŒ–
    __crc16_mutex_init();

    // 11. P33 IOé”å­˜åˆå§‹åŒ–
    p33_io_latch_init();
}
```

**æ—¶é’Ÿé…ç½®**:
- `sys_clk`: ç³»ç»Ÿæ—¶é’Ÿï¼ˆé€šå¸¸320MHzï¼‰
- `sdram_clk`: SDRAMæ—¶é’Ÿ
- `hsb_clk`: é«˜é€Ÿæ€»çº¿æ—¶é’Ÿ
- `lsb_clk`: ä½é€Ÿæ€»çº¿æ—¶é’Ÿ
- `sfc_clk`: SPI Flashæ§åˆ¶å™¨æ—¶é’Ÿ

---

### ğŸ¯ é˜¶æ®µ3: app_task_handler() - åº”ç”¨ä»»åŠ¡

**ä½ç½®**: `apps/common/system/init.c:180`

```c
static void app_task_handler(void *p)
{
    // ====== ç¬¬ä¸€éƒ¨åˆ†: ç³»ç»Ÿçº§åˆå§‹åŒ– ======
    
    // 1. ç³»ç»Ÿå®šæ—¶å™¨åˆå§‹åŒ–
    sys_timer_init();
    sys_timer_task_init();

    // 2. RTOSæ ˆæ£€æŸ¥ (å¦‚å¯ç”¨)
    #ifdef RTOS_STACK_CHECK_ENABLE
        sys_timer_add(NULL, rtos_stack_check_func, 60 * 1000);
    #endif

    // 3. å†…å­˜æ³„æ¼æ£€æµ‹ (å¦‚å¯ç”¨)
    #ifdef MEM_LEAK_CHECK_ENABLE
        malloc_debug_start();
        sys_timer_add(NULL, malloc_debug_dump, 60 * 1000);
    #endif

    // ====== ç¬¬äºŒéƒ¨åˆ†: æ¿çº§åˆå§‹åŒ– ======
    
    // 4. æ¿çº§æ—©æœŸåˆå§‹åŒ– (å¼±å‡½æ•°,å¯è¦†ç›–)
    board_early_init();

    // 5. æ—©æœŸåˆå§‹åŒ–å›è°ƒ
    __do_initcall(early_initcall);
    /*
       æ‰§è¡Œæ‰€æœ‰é€šè¿‡ early_initcall() æ³¨å†Œçš„å‡½æ•°:
       - mutex_init()
       - sys_event_init()
       - thread_fork_init()
       - sdfile_init()
       - ntp_client_init()
    */

    // 6. SDå¡å¤–éƒ¨æ–‡ä»¶ç³»ç»ŸæŒ‚è½½
    #ifdef CONFIG_SDFILE_EXT_ENABLE
        sdfile_ext_mount_init();
    #endif

    // 7. å¹³å°åˆå§‹åŒ–å›è°ƒ
    __do_initcall(platform_initcall);

    // 8. æ¿çº§åˆå§‹åŒ– (å¼±å‡½æ•°,å¯è¦†ç›–)
    board_init();

    // ====== ç¬¬ä¸‰éƒ¨åˆ†: æ¨¡å—åˆå§‹åŒ– ======

    // 9. RF FCCæµ‹è¯•æ¨¡å¼æ£€æµ‹
    #ifdef RF_FCC_TEST_ENABLE
        if (rf_fcc_test_init()) {
            while (1) os_time_dly(10);  // è¿›å…¥æµ‹è¯•æ¨¡å¼
        }
    #endif

    // 10. é€šç”¨åˆå§‹åŒ–å›è°ƒ
    __do_initcall(initcall);

    // 11. æ¨¡å—åˆå§‹åŒ–å›è°ƒ
    __do_initcall(module_initcall);

    // 12. åº”ç”¨æ ¸å¿ƒåˆå§‹åŒ–
    app_core_init();
    /*
       - åˆå§‹åŒ–åº”ç”¨ç®¡ç†å™¨
       - æ³¨å†Œæ‰€æœ‰åº”ç”¨ (é€šè¿‡REGISTER_APPLICATIONæ³¨å†Œçš„)
       - åˆå§‹åŒ–åº”ç”¨äº‹ä»¶ç³»ç»Ÿ
    */

    // 13. åæœŸåˆå§‹åŒ–å›è°ƒ
    __do_initcall(late_initcall);
    /*
       æ‰§è¡Œæ‰€æœ‰é€šè¿‡ late_initcall() æ³¨å†Œçš„å‡½æ•°:
       - c_main()
       - robot_init()
       - config_save_flash()
       - wireless_net_init()
       - sdk_meky_check()
    */

    // ====== ç¬¬å››éƒ¨åˆ†: åº”ç”¨å¯åŠ¨ ======

    // 14. è¿›å…¥åº”ç”¨ä¸»å‡½æ•°
    app_main();  // ç”±å…·ä½“åº”ç”¨å®ç°
    /*
       ä¸åŒçš„åº”ç”¨æœ‰ä¸åŒå®ç°:
       - wifi_story_machine: å¯åŠ¨éŸ³ä¹æ’­æ”¾åº”ç”¨
       - wifi_camera: å¯åŠ¨æ‘„åƒå¤´åº”ç”¨
       - wifi_ipc: å¯åŠ¨IPCåº”ç”¨
       - demo_xxx: å¯åŠ¨å¯¹åº”Demoåº”ç”¨
    */

    // 15. Finsh Shellåˆå§‹åŒ– (å¦‚å¯ç”¨)
    #ifdef CONFIG_FINSH_ENABLE
        finsh_system_init();
    #endif

    // ====== ç¬¬äº”éƒ¨åˆ†: ä¸»å¾ªç¯ ======

    int res;
    int msg[32];

    // 16. è¿›å…¥æ¶ˆæ¯å¾ªç¯
    while (1) {
        // ç­‰å¾…ä»»åŠ¡æ¶ˆæ¯
        res = os_task_pend("taskq", msg, ARRAY_SIZE(msg));
        
        if (res != OS_TASKQ) {
            continue;
        }
        
        // å¤„ç†åº”ç”¨æ ¸å¿ƒæ¶ˆæ¯
        app_core_msg_handler(msg);
        /*
           å¤„ç†å„ç§ç³»ç»Ÿæ¶ˆæ¯:
           - æŒ‰é”®äº‹ä»¶ (SYS_KEY_EVENT)
           - è§¦æ‘¸äº‹ä»¶ (SYS_TOUCH_EVENT)
           - è®¾å¤‡äº‹ä»¶ (SYS_DEVICE_EVENT)
           - ç½‘ç»œäº‹ä»¶ (SYS_NET_EVENT)
           - è“ç‰™äº‹ä»¶ (SYS_BT_EVENT)
        */
    }
}
```

---

### ğŸ® é˜¶æ®µ4: app_main() - åº”ç”¨ä¸»å‡½æ•°

ä»¥**WiFiæ•…äº‹æœº**ä¸ºä¾‹ (`apps/wifi_story_machine/app_main.c:207`):

```c
void app_main()
{
    struct intent it;

    puts("------------- wifi_story_machine app main-------------\n");

    // 1. åˆå§‹åŒ–æ„å›¾ç»“æ„
    init_intent(&it);
    
    // 2. è®¾ç½®è¦å¯åŠ¨çš„åº”ç”¨åç§°å’ŒåŠ¨ä½œ
    it.name = "app_music";  // åº”ç”¨åç§°
    it.action = ACTION_MUSIC_PLAY_MAIN;  // å¯åŠ¨åŠ¨ä½œ

    // 3. å¯åŠ¨åº”ç”¨
    start_app(&it);
    /*
       - æŸ¥æ‰¾æ³¨å†Œçš„åº”ç”¨
       - åˆ›å»ºåº”ç”¨å®ä¾‹
       - æ‰§è¡Œåº”ç”¨çŠ¶æ€æœº (CREATE -> START)
       - åˆå§‹åŒ–åº”ç”¨ç§æœ‰æ•°æ®
       - å¯åŠ¨åº”ç”¨ä»»åŠ¡
    */

    // 4. è“ç‰™æ¨¡å—åˆå§‹åŒ– (å¦‚å¯ç”¨ä¸”æ— WiFi)
    #if defined CONFIG_BT_ENABLE && !defined CONFIG_WIFI_ENABLE
        bt_ble_module_init();
    #endif
}
```

**å…¶ä»–åº”ç”¨ç¤ºä¾‹**:

**WiFi Camera**:
```c
void app_main()
{
    init_intent(&it);
    it.name = "video_rec";
    it.action = ACTION_VIDEO_REC_MAIN;
    start_app(&it);
}
```

**Demo DevKitBoard**:
```c
void app_main()
{
    init_intent(&it);
    it.name = "app_demo";
    it.action = ACTION_DO_NOTHING;
    start_app(&it);
}
```

---

## 3ï¸âƒ£ å…³é”®æ•°æ®ç»“æ„

### ğŸ“¦ åº”ç”¨ç¨‹åºç»“æ„

**ä½ç½®**: `include_lib/system/app_core.h:42`

```c
struct application {
    u8 state;                           // åº”ç”¨çŠ¶æ€
    int action;                         // å¯åŠ¨åŠ¨ä½œ
    char *data;                         // æ•°æ®æŒ‡é’ˆ
    const char *name;                   // åº”ç”¨åç§°
    struct list_head entry;             // é“¾è¡¨èŠ‚ç‚¹
    void *private_data;                 // ç§æœ‰æ•°æ®
    const struct application_operation *ops;  // æ“ä½œé›†
};

struct application_operation {
    // çŠ¶æ€æœºå¤„ç†å‡½æ•°
    int (*state_machine)(struct application *, enum app_state, struct intent *);
    // äº‹ä»¶å¤„ç†å‡½æ•°
    int (*event_handler)(struct application *, struct sys_event *);
};
```

**åº”ç”¨çŠ¶æ€æšä¸¾**:
```c
enum app_state {
    APP_STA_CREATE,     // åˆ›å»º
    APP_STA_START,      // å¯åŠ¨
    APP_STA_PAUSE,      // æš‚åœ
    APP_STA_RESUME,     // æ¢å¤
    APP_STA_STOP,       // åœæ­¢
    APP_STA_DESTROY,    // é”€æ¯
};
```

### ğŸ“ Intentç»“æ„

```c
struct intent {
    const char *name;   // ç›®æ ‡åº”ç”¨åç§°
    int action;         // è¦æ‰§è¡Œçš„åŠ¨ä½œ
    const char *data;   // æ•°æ®æŒ‡é’ˆ
    u32 exdata;         // æ‰©å±•æ•°æ®
};
```

---

## 4ï¸âƒ£ åˆå§‹åŒ–æœºåˆ¶

### ğŸ”„ Initcallæœºåˆ¶

**ä½ç½®**: `include_lib/system/init.h`

SDKä½¿ç”¨**initcallæœºåˆ¶**å®ç°æ¨¡å—åŒ–åˆå§‹åŒ–ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ†ä¸º5ä¸ªé˜¶æ®µï¼š

```c
// å®šä¹‰initcallç±»å‹
typedef int (*initcall_t)(void);

// 1. æ—©æœŸåˆå§‹åŒ– (æœ€å…ˆæ‰§è¡Œ)
#define early_initcall(fn) \
    const initcall_t __initcall_##fn SEC_USED(.early.initcall) = fn

// 2. å¹³å°åˆå§‹åŒ–
#define platform_initcall(fn) \
    const initcall_t __initcall_##fn SEC_USED(.platform.initcall) = fn

// 3. æ™®é€šåˆå§‹åŒ–
#define __initcall(fn) \
    const initcall_t __initcall_##fn SEC_USED(.initcall) = fn

// 4. æ¨¡å—åˆå§‹åŒ–
#define module_initcall(fn) \
    const initcall_t __initcall_##fn SEC_USED(.module.initcall) = fn

// 5. åæœŸåˆå§‹åŒ– (æœ€åæ‰§è¡Œ)
#define late_initcall(fn) \
    const initcall_t __initcall_##fn SEC_USED(.late.initcall) = fn

// æ‰§è¡Œinitcallå®
#define __do_initcall(prefix) \
    do { \
        initcall_t *init; \
        extern initcall_t prefix##_begin[], prefix##_end[]; \
        for (init = prefix##_begin; init < prefix##_end; init++) { \
            (*init)(); \
        } \
    } while(0)
```

#### ğŸ“‹ Initcallæ‰§è¡Œé¡ºåº

**åœ¨ `app_task_handler()` ä¸­çš„æ‰§è¡Œé¡ºåº**:

```
1. early_initcall    â†’ äº’æ–¥é”ã€äº‹ä»¶ç³»ç»Ÿã€çº¿ç¨‹æ± ã€æ–‡ä»¶ç³»ç»Ÿ
2. platform_initcall â†’ å¹³å°è®¾å¤‡é©±åŠ¨
3. initcall          â†’ é€šç”¨æ¨¡å—
4. module_initcall   â†’ åŠŸèƒ½æ¨¡å—
5. late_initcall     â†’ åæœŸåˆå§‹åŒ–ï¼ˆC++ã€æœºå™¨äººã€é…ç½®ã€ç½‘ç»œï¼‰
```

#### ğŸ” å®é™…æ³¨å†Œçš„Initcallç¤ºä¾‹

**Early Initcall** (ä»mapæ–‡ä»¶æŸ¥çœ‹):
```
__initcall_mutex_init           // äº’æ–¥é”åˆå§‹åŒ–
__initcall___sd_mutex_init      // SDå¡äº’æ–¥é”
__initcall_app_version_check    // ç‰ˆæœ¬æ£€æŸ¥
__initcall_sys_event_init       // ç³»ç»Ÿäº‹ä»¶åˆå§‹åŒ–
__initcall_thread_fork_init     // çº¿ç¨‹æ± åˆå§‹åŒ–
__initcall_sdfile_init          // SDæ–‡ä»¶ç³»ç»Ÿ
__initcall_ntp_client_init      // NTPå®¢æˆ·ç«¯
```

**Late Initcall**:
```
__initcall_c_main               // C++ä¸»å‡½æ•°
__initcall_robot_init           // æœºå™¨äººåˆå§‹åŒ–
__initcall_config_save_flash    // é…ç½®ä¿å­˜
__initcall_wireless_net_init    // æ— çº¿ç½‘ç»œ
__initcall_sdk_meky_check       // SDKå¯†é’¥æ£€æŸ¥
```

---

## 5ï¸âƒ£ åº”ç”¨ç¨‹åºå¯åŠ¨

### ğŸ¯ åº”ç”¨æ³¨å†Œæœºåˆ¶

**å®å®šä¹‰**: `REGISTER_APPLICATION(app_name)`

```c
// å®šä¹‰åœ¨ include_lib/system/app_core.h:54
#define REGISTER_APPLICATION(at) \
    static struct application at SEC_USED(.app)
```

**ä½¿ç”¨ç¤ºä¾‹** (ä» `apps/demo/demo_DevKitBoard/app_main.c`):

```c
// 1. å®šä¹‰åº”ç”¨æ“ä½œé›†
static const struct application_operation app_demo_ops = {
    .state_machine  = app_demo_state_machine,   // çŠ¶æ€æœºå‡½æ•°
    .event_handler  = app_demo_event_handler,   // äº‹ä»¶å¤„ç†å‡½æ•°
};

// 2. æ³¨å†Œåº”ç”¨
REGISTER_APPLICATION(app_demo) = {
    .name   = "app_demo",           // åº”ç”¨åç§°
    .ops    = &app_demo_ops,        // æ“ä½œé›†
    .state  = APP_STA_DESTROY,      // åˆå§‹çŠ¶æ€
};
```

### ğŸš€ åº”ç”¨å¯åŠ¨æµç¨‹

**å‡½æ•°**: `start_app(struct intent *it)`

```
1. æŸ¥æ‰¾åº”ç”¨
   â”œâ”€ éå† .app æ®µä¸­æ³¨å†Œçš„æ‰€æœ‰åº”ç”¨
   â””â”€ åŒ¹é… intent.name ä¸åº”ç”¨åç§°

2. åˆ‡æ¢åº”ç”¨
   â”œâ”€ åœæ­¢å½“å‰åº”ç”¨ (å¦‚æœ‰)
   â”‚  â”œâ”€ è°ƒç”¨ state_machine(APP_STA_STOP)
   â”‚  â””â”€ è°ƒç”¨ state_machine(APP_STA_DESTROY)
   â””â”€ ä¿å­˜ä¸ºprev_app (ç”¨äºè¿”å›)

3. å¯åŠ¨æ–°åº”ç”¨
   â”œâ”€ è°ƒç”¨ state_machine(APP_STA_CREATE, intent)
   â”‚  â””â”€ åº”ç”¨åˆå§‹åŒ–ç§æœ‰æ•°æ®
   â”œâ”€ è°ƒç”¨ state_machine(APP_STA_START, intent)
   â”‚  â””â”€ åº”ç”¨å¯åŠ¨ä¸»è¦åŠŸèƒ½
   â””â”€ è®¾ç½®ä¸ºcurrent_app

4. è¿›å…¥åº”ç”¨ä¸»å¾ªç¯
   â””â”€ å¤„ç†åº”ç”¨äº‹ä»¶ (é€šè¿‡event_handler)
```

---

## 6ï¸âƒ£ ä»»åŠ¡åˆ—è¡¨

SDKä¸­é¢„å®šä¹‰çš„ä»»åŠ¡é…ç½® (ä» `apps/wifi_story_machine/app_main.c:65`):

| ä»»åŠ¡åç§° | ä¼˜å…ˆçº§ | æ ˆå¤§å° | é˜Ÿåˆ—å¤§å° | åŠŸèƒ½æè¿° |
|---------|-------|--------|---------|----------|
| **app_core** | 15 | 2048 | 1024 | åº”ç”¨æ ¸å¿ƒä»»åŠ¡ |
| **sys_event** | 29 | 512 | 0 | ç³»ç»Ÿäº‹ä»¶å¤„ç† |
| **sys_timer** | 9 | 512 | 128 | ç³»ç»Ÿå®šæ—¶å™¨ |
| **systimer** | 14 | 256 | 0 | ç³»ç»Ÿæ—¶é’Ÿ |
| **audio_server** | 16 | 512 | 64 | éŸ³é¢‘æœåŠ¡å™¨ |
| **audio_encoder** | 12 | 384 | 64 | éŸ³é¢‘ç¼–ç å™¨ |
| **opus_encoder** | 13 | 1536 | 0 | Opusç¼–ç å™¨ |
| **mp3_encoder** | 13 | 768 | 0 | MP3ç¼–ç å™¨ |
| **video_server** | 16 | 768 | 128 | è§†é¢‘æœåŠ¡å™¨ |
| **ui** | 21 | 768 | 256 | UIä»»åŠ¡ |
| **tcpip_thread** | 16 | 800 | 0 | TCP/IPåè®®æ ˆ |
| **tasklet** | 10 | 1400 | 0 | WiFiä»»åŠ¡å¤„ç† |
| **RtmpMlmeTask** | 17 | 700 | 0 | WiFi MLMEä»»åŠ¡ |
| **RtmpCmdQTask** | 17 | 300 | 0 | WiFiå‘½ä»¤é˜Ÿåˆ— |
| **wl_rx_irq_thread** | 7 | 256 | 0 | WiFiæ¥æ”¶ä¸­æ–­ |
| **btctrler** | 19 | 512 | 384 | è“ç‰™æ§åˆ¶å™¨ |
| **btstack** | 18 | 768 | 384 | è“ç‰™åè®®æ ˆ |

**ä¼˜å…ˆçº§è¯´æ˜**:
- æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
- 0-9: é«˜ä¼˜å…ˆçº§ (ä¸­æ–­ã€å®æ—¶ä»»åŠ¡)
- 10-20: ä¸­ä¼˜å…ˆçº§ (ä¸šåŠ¡é€»è¾‘)
- 21-30: ä½ä¼˜å…ˆçº§ (UIã€äº‹ä»¶å¤„ç†)

---

## 7ï¸âƒ£ åŒæ ¸å¯åŠ¨æµç¨‹

AC79æ”¯æŒåŒæ ¸DSPï¼Œå¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸Šç”µ/å¤ä½      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CPU0 å¯åŠ¨     â”‚
â”‚   æ‰§è¡Œ main()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ setup_arch()
         â”œâ”€â”€â”€ os_init()
         â””â”€â”€â”€ EnableOtherCpu()  // å¯åŠ¨CPU1
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   CPU1 å¯åŠ¨     â”‚
         â”‚   cpu1_main()   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€â”€â”€ interrupt_init()
                  â”œâ”€â”€â”€ debug_init()
                  â””â”€â”€â”€ os_start()
```

**CPU1ä¸»å‡½æ•°** (`apps/common/system/init.c:99`):

```c
void cpu1_main(void)
{
    cpu1_run_flag = 1;  // æ ‡è®°CPU1å·²å¯åŠ¨
    
    __local_irq_disable();
    
    // åˆå§‹åŒ–ä¸­æ–­
    interrupt_init();
    
    // åˆå§‹åŒ–è°ƒè¯•
    debug_init();
    
    #if CPU_CORE_NUM > 1
        os_start();  // å¯åŠ¨RTOS (åŒæ ¸æ¨¡å¼)
    #else
        puts("\r\n\n cpu1_run... \r\n\n");
    #endif
    
    __local_irq_enable();
    
    // è¿›å…¥ç©ºé—²å¾ªç¯
    while (1) {
        __asm__ volatile("idle");
    }
}
```

---

## 8ï¸âƒ£ å¯åŠ¨æµç¨‹å›¾ï¼ˆå®Œæ•´ç‰ˆï¼‰

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ              AC79 SDK å®Œæ•´å¯åŠ¨æµç¨‹                  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

 [ç¡¬ä»¶å¤ä½]
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bootloader (Flashå¯åŠ¨ä»£ç )                 â”‚
â”‚ - ä» 0x2000120 åŠ è½½ä»£ç                      â”‚
â”‚ - åˆå§‹åŒ–SDRAM (å¦‚ä½¿ç”¨)                      â”‚
â”‚ - è·³è½¬åˆ° _start                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ main() [apps/common/system/init.c:264]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. __local_irq_disable()                    â”‚
â”‚ 2. setup_arch()         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ 3. EnableOtherCpu()               â”‚          â”‚
â”‚ 4. os_init()                      â”‚          â”‚
â”‚ 5. task_create(app_task_handler)  â”‚          â”‚
â”‚ 6. os_start()                     â”‚          â”‚
â”‚ 7. __local_irq_enable()           â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                    â”‚                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
        â”‚                         â”‚            â”‚
        â–¼                         â–¼            â–¼
   [CPU0 è°ƒåº¦]              [CPU1å¯åŠ¨]   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  cpu1_main()   â”‚ setup_arch() â”‚
        â”‚                         â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â–¼                         â–¼      â”‚ â€¢ wdt_init() â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      [CPU1ç©ºé—²]    â”‚ â€¢ clk_init() â”‚
â”‚ RTOS Scheduler   â”‚                     â”‚ â€¢ uart_init()â”‚
â”‚ - FreeRTOS       â”‚                     â”‚ â€¢ debug_initâ”‚
â”‚ - ä»»åŠ¡è°ƒåº¦å¼€å§‹   â”‚                     â”‚ â€¢ æ‰“å°ä¿¡æ¯   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ app_task_handler() [ä¼˜å…ˆçº§15]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¸ ç³»ç»Ÿåˆå§‹åŒ–é˜¶æ®µ                            â”‚
â”‚   â”œâ”€ sys_timer_init()                       â”‚
â”‚   â”œâ”€ sys_timer_task_init()                  â”‚
â”‚   â””â”€ [å¯é€‰] rtos_stack_check / mem_debug    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¸ æ¿çº§åˆå§‹åŒ–é˜¶æ®µ                            â”‚
â”‚   â”œâ”€ board_early_init()                     â”‚
â”‚   â”œâ”€ __do_initcall(early_initcall) â”€â”€â”€â”€â”    â”‚
â”‚   â”œâ”€ sdfile_ext_mount_init()           â”‚    â”‚
â”‚   â”œâ”€ __do_initcall(platform_initcall)â”€â”€â”¤    â”‚
â”‚   â””â”€ board_init()                       â”‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¸ æ¨¡å—åˆå§‹åŒ–é˜¶æ®µ                            â”‚
â”‚   â”œâ”€ rf_fcc_test_init()                 â”‚    â”‚
â”‚   â”œâ”€ __do_initcall(initcall) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚   â”œâ”€ __do_initcall(module_initcall) â”€â”€â”€â”€â”¤    â”‚
â”‚   â”œâ”€ app_core_init() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚   â””â”€ __do_initcall(late_initcall) â”€â”€â”€â”¤  â”‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¸ åº”ç”¨å¯åŠ¨é˜¶æ®µ                              â”‚
â”‚   â””â”€ app_main() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚                                    â”‚     â”‚    â”‚
â”‚ â–¸ ä¸»å¾ªç¯                           â”‚     â”‚    â”‚
â”‚   â””â”€ while(1) {                    â”‚     â”‚    â”‚
â”‚       os_task_pend(msg)            â”‚     â”‚    â”‚
â”‚       app_core_msg_handler(msg)    â”‚     â”‚    â”‚
â”‚     }                              â”‚     â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
         â”‚                                 â”‚    â”‚
         â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚          â”‚                           â”‚
         â–¼          â–¼                           â–¼
   [æ¶ˆæ¯å¾ªç¯]  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     â”‚  app_main()  â”‚    â”‚ Initcall Functions  â”‚
         â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚     â”‚å…·ä½“åº”ç”¨å®ç°  â”‚    â”‚ early_initcall:     â”‚
         â–¼     â”‚              â”‚    â”‚ â€¢ mutex_init        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç¤ºä¾‹1:       â”‚    â”‚ â€¢ sys_event_init    â”‚
    â”‚äº‹ä»¶åˆ†å‘â”‚ â”‚ wifi_story   â”‚    â”‚ â€¢ sdfile_init       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   init_intentâ”‚    â”‚                     â”‚
    â”‚â€¢æŒ‰é”®   â”‚ â”‚   start_app  â”‚    â”‚ platform_initcall:  â”‚
    â”‚â€¢è§¦æ‘¸   â”‚ â”‚              â”‚    â”‚ â€¢ device_drivers    â”‚
    â”‚â€¢è®¾å¤‡   â”‚ â”‚ ç¤ºä¾‹2:       â”‚    â”‚                     â”‚
    â”‚â€¢ç½‘ç»œ   â”‚ â”‚ wifi_camera  â”‚    â”‚ late_initcall:      â”‚
    â”‚â€¢è“ç‰™   â”‚ â”‚   video_rec  â”‚    â”‚ â€¢ c_main            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   start      â”‚    â”‚ â€¢ robot_init        â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ wireless_net_init â”‚
                      â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  start_app()   â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚ 1. æŸ¥æ‰¾åº”ç”¨    â”‚
            â”‚ 2. åœæ­¢æ—§åº”ç”¨  â”‚
            â”‚ 3. åˆ›å»ºæ–°åº”ç”¨  â”‚
            â”‚ 4. å¯åŠ¨æ–°åº”ç”¨  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ åº”ç”¨çŠ¶æ€æœº             â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ CREATE  â†’ åˆå§‹åŒ–       â”‚
         â”‚ START   â†’ å¯åŠ¨åŠŸèƒ½     â”‚
         â”‚ PAUSE   â†’ æš‚åœ         â”‚
         â”‚ RESUME  â†’ æ¢å¤         â”‚
         â”‚ STOP    â†’ åœæ­¢         â”‚
         â”‚ DESTROY â†’ é”€æ¯         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ åº”ç”¨äº‹ä»¶å¾ªç¯           â”‚
         â”‚ - event_handler()      â”‚
         â”‚ - å¤„ç†ç³»ç»Ÿäº‹ä»¶         â”‚
         â”‚ - å¤„ç†åº”ç”¨é€»è¾‘         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9ï¸âƒ£ æ—¶é—´çº¿ä¼°ç®—

å¯åŠ¨å„é˜¶æ®µçš„å¤§è‡´æ—¶é—´ï¼ˆä»¥WiFiæ•…äº‹æœºä¸ºä¾‹ï¼‰:

| é˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|-----|------|------|
| Bootloader | ~50ms | Flashè¯»å–å’ŒåŠ è½½ |
| setup_arch() | ~100ms | ç¡¬ä»¶åˆå§‹åŒ– |
| RTOSå¯åŠ¨ | ~50ms | ä»»åŠ¡åˆ›å»ºå’Œè°ƒåº¦å™¨å¯åŠ¨ |
| early_initcall | ~20ms | åŸºç¡€æ¨¡å—åˆå§‹åŒ– |
| platform_initcall | ~50ms | å¹³å°è®¾å¤‡åˆå§‹åŒ– |
| initcall + module | ~100ms | åŠŸèƒ½æ¨¡å—åˆå§‹åŒ– |
| app_core_init | ~30ms | åº”ç”¨æ ¸å¿ƒåˆå§‹åŒ– |
| late_initcall | ~80ms | åæœŸåˆå§‹åŒ– |
| app_main() | ~200ms | åº”ç”¨å¯åŠ¨ï¼ˆå«WiFiåˆå§‹åŒ–ï¼‰ |
| **æ€»è®¡** | **~680ms** | ä»ä¸Šç”µåˆ°åº”ç”¨è¿è¡Œ |

---

## ğŸ”Ÿ å…³é”®é…ç½®å®

| å®å®šä¹‰ | è¯´æ˜ | ä½ç½® |
|-------|------|------|
| `CONFIG_DEBUG_ENABLE` | å¯ç”¨è°ƒè¯•åŠŸèƒ½ | app_config.h |
| `CONFIG_WIFI_ENABLE` | å¯ç”¨WiFiåŠŸèƒ½ | app_config.h |
| `CONFIG_BT_ENABLE` | å¯ç”¨è“ç‰™åŠŸèƒ½ | app_config.h |
| `CONFIG_SFC_ENABLE` | å¯ç”¨SPI Flash | app_config.h |
| `CPU_CORE_NUM` | CPUæ ¸å¿ƒæ•°é‡ (1æˆ–2) | app_config.h |
| `CONFIG_MMU_ENABLE` | å¯ç”¨MMU | app_config.h |
| `CONFIG_UI_ENABLE` | å¯ç”¨UIåŠŸèƒ½ | app_config.h |
| `RTOS_STACK_CHECK_ENABLE` | å¯ç”¨æ ˆæ£€æŸ¥ | app_config.h |

---

## ğŸ“š å‚è€ƒæ–‡ä»¶åˆ—è¡¨

### æ ¸å¿ƒå¯åŠ¨æ–‡ä»¶
- `apps/common/system/init.c` - ä¸»å¯åŠ¨æ–‡ä»¶
- `cpu/wl82/setup.c` - CPUæ¶æ„åˆå§‹åŒ–
- `cpu/wl82/sdk_ld_sfc.c` - SFCæ¨¡å¼é“¾æ¥è„šæœ¬
- `cpu/wl82/sdk_ld_sdram.c` - SDRAMæ¨¡å¼é“¾æ¥è„šæœ¬

### åº”ç”¨ç¤ºä¾‹
- `apps/wifi_story_machine/app_main.c` - WiFiæ•…äº‹æœº
- `apps/wifi_camera/app_main.c` - WiFiæ‘„åƒå¤´
- `apps/wifi_ipc/app_main.c` - WiFi IPC
- `apps/demo/demo_DevKitBoard/app_main.c` - Demoå¼€å‘æ¿

### ç³»ç»Ÿå¤´æ–‡ä»¶
- `include_lib/system/init.h` - åˆå§‹åŒ–æœºåˆ¶
- `include_lib/system/app_core.h` - åº”ç”¨æ ¸å¿ƒ
- `include_lib/system/os/os_api.h` - OS API

---

## ğŸ“ æ€»ç»“

AC79 SDKçš„å¯åŠ¨æµç¨‹è®¾è®¡ç²¾å·§ï¼Œé‡‡ç”¨**åˆ†å±‚åˆå§‹åŒ–**å’Œ**æ¨¡å—åŒ–**çš„æ¶æ„ï¼š

### âœ… å…³é”®ç‰¹æ€§
1. **åŒæ ¸æ”¯æŒ**: CPU0å’ŒCPU1ç‹¬ç«‹åˆå§‹åŒ–å’Œè¿è¡Œ
2. **Initcallæœºåˆ¶**: 5çº§åˆå§‹åŒ–ä¼˜å…ˆçº§ï¼Œæ¨¡å—è‡ªåŠ¨æ³¨å†Œ
3. **åº”ç”¨æ¡†æ¶**: ç»Ÿä¸€çš„åº”ç”¨ç®¡ç†å’ŒçŠ¶æ€æœº
4. **RTOSé›†æˆ**: åŸºäºFreeRTOSçš„å¤šä»»åŠ¡è°ƒåº¦
5. **çµæ´»é…ç½®**: ä¸°å¯Œçš„å®é…ç½®é€‰é¡¹

### ğŸ¯ å¯åŠ¨æµç¨‹è¦ç‚¹
- `main()` â†’ `setup_arch()` â†’ `app_task_handler()` â†’ `app_main()`
- å„é˜¶æ®µé€šè¿‡initcallæœºåˆ¶æ³¨å†Œå’Œæ‰§è¡Œåˆå§‹åŒ–å‡½æ•°
- åº”ç”¨é€šè¿‡REGISTER_APPLICATIONæ³¨å†Œï¼Œstart_app()å¯åŠ¨
- æœ€ç»ˆè¿›å…¥äº‹ä»¶é©±åŠ¨çš„æ¶ˆæ¯å¾ªç¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-31  
**é€‚ç”¨SDK**: AC79NN_SDK_V1.2.0

